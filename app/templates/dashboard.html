<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Imóveis</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/noUiSlider@15.7.1/dist/nouislider.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');
        
        :root {
            --primary-color: #8e44ad;
            --secondary-color: #3498db;
            --highlight-color: #f39c12;
            --background-start: #1a1a2e;
            --background-end: #16213e;
            --card-bg: #1f2847;
            --text-color: #e0e0e0;
            --text-muted-color: #a0a0a0;
            --border-color: #2c3e50;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --font-family: 'Poppins', sans-serif;
            --lime-green-text: #ccff00;
            --glass-bg: rgba(31, 40, 71, 0.8);
            --orange-color: #f39c12;
        }
        
        body {
            background: linear-gradient(-45deg, var(--background-start), var(--background-end), #0f3460, #1a1a2e);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: var(--text-color);
            font-family: var(--font-family);
            min-height: 100vh;
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        h1 {
            color: var(--secondary-color);
            font-weight: 700;
            text-shadow: 0 0 20px rgba(52, 152, 219, 0.3);
        }
        
        .card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }
        
        .kpi-card h5 {
            color: var(--text-muted-color);
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 1px;
        }
        
        .kpi-card p {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--success-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .table-dark {
            --bs-table-bg: var(--glass-bg);
            --bs-table-border-color: rgba(255, 255, 255, 0.1);
            --bs-table-striped-bg: rgba(255, 255, 255, 0.05);
        }
        
        .btn {
            border-radius: 25px;
            padding: 10px 25px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), #9b59b6);
            box-shadow: 0 4px 15px rgba(142, 68, 173, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(142, 68, 173, 0.5);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success-color), #27ae60);
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(46, 204, 113, 0.5);
        }
        
        .btn-info {
             background: linear-gradient(135deg, var(--secondary-color), #2980b9);
             box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.5);
        }
        
        .btn-outline-info {
            color: var(--secondary-color);
            border: 2px solid var(--secondary-color);
            background: transparent;
        }
        
        .btn-outline-info:hover {
            background: var(--secondary-color);
            color: white;
            transform: translateY(-2px);
        }
        
        .btn-outline-secondary {
            color: var(--text-color);
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: transparent;
        }
        
        .btn-outline-secondary:hover {
            background: var(--secondary-color);
            border-color: var(--secondary-color);
            color: white;
            transform: translateY(-2px);
        }
        
        .form-select, .form-control {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            color: var(--text-color);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
        }
        
        .form-select:focus, .form-control:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
            background: rgba(255, 255, 255, 0.15);
        }

        .form-select option {
            background: var(--card-bg);
            color: var(--text-color);
        }
        
        .opportunity-card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            padding: 1.2rem;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .opportunity-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
        }
        
        .opportunity-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }
        
        .opportunity-card:hover::before {
            left: 100%;
        }
        
        .opportunity-card h5 {
            color: var(--success-color);
            font-weight: bold;
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
        }
        
        .opportunity-card p {
            background: rgba(255, 255, 255, 0.9);
            color: #1a1a2e;
            padding: 4px 8px;
            border-radius: 6px;
            margin-bottom: 0.3rem;
            display: inline-block;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        #vertical-carousel-container {
            height: 350px;
            overflow: hidden;
            position: relative;
            border-radius: 10px;
        }
        
        #vertical-carousel-inner {
            position: absolute;
            width: 100%;
            animation: vertical-scroll 15s linear infinite;
        }
        
        #vertical-carousel-container:hover #vertical-carousel-inner {
            animation-play-state: paused;
        }
        
        @keyframes vertical-scroll {
            0% { top: 0; }
            100% { top: -100%; }
        }
        
        .modal-content {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-color);
            border-radius: 15px;
        }
        
        .modal-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .modal-title {
            color: var(--secondary-color);
            font-weight: 600;
        }
        
        .btn-close {
            filter: invert(1);
        }
        
        .form-check-input:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        #estados-pesquisa-container, #export-estados-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
        }
        
        #progress-container {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
            z-index: 1050;
            box-shadow: 0 -5px 25px rgba(0, 0, 0, 0.3);
        }
        
        .progress {
            height: 8px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .progress-bar {
            border-radius: 10px;
            background: linear-gradient(135deg, var(--success-color), var(--secondary-color));
            transition: all 0.3s ease;
        }
        
        .lime-green-header {
            color: var(--lime-green-text) !important;
            font-weight: 600;
            text-shadow: 0 0 10px rgba(204, 255, 0, 0.3);
        }
        
        .dataTables_wrapper .dataTables_info,
        .dataTables_wrapper .dataTables_paginate {
            color: var(--text-color) !important;
        }
        
        .dataTables_wrapper .dataTables_paginate .page-item .page-link {
            background: var(--glass-bg) !important;
            color: var(--text-color) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            border-radius: 8px !important;
        }
        
        .dataTables_wrapper .dataTables_paginate .page-item.active .page-link {
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color)) !important;
            border-color: var(--secondary-color) !important;
        }
        
        .dataTables_wrapper .dataTables_length,
        .dataTables_wrapper .dataTables_filter {
            color: var(--text-color) !important;
        }
        
        .filter-section {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .filter-label {
            color: var(--text-muted-color);
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .price-range-container {
            padding: 20px 0;
        }
        
        .noUi-connect {
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
        }
        
        .noUi-handle {
            background: white;
            border: none;
            border-radius: 50%;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .noUi-target {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 10px;
        }

        .price-column {
            color: #2ecc71 !important;
            font-weight: 600;
        }

        .discount-column {
            color: #e74c3c !important;
            font-weight: 600;
        }

        .area-column {
            color: #3498db !important;
        }

        .preco-m2-column {
            color: var(--orange-color) !important;
            font-weight: 600;
        }

        .tipo-column {
            color: #9b59b6 !important;
            font-weight: 500;
        }

        .status-novo { 
            background: rgba(46, 204, 113, 0.2) !important; 
            color: #2ecc71 !important; 
            border: 1px solid #2ecc71 !important; 
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        .status-existente { 
            background: rgba(52, 152, 219, 0.2) !important; 
            color: #3498db !important; 
            border: 1px solid #3498db !important; 
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        .status-atualizado { 
            background: rgba(204, 255, 0, 0.2) !important; 
            color: #ccff00 !important; 
            border: 1px solid #ccff00 !important; 
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        .status-expirado { 
            background: rgba(231, 76, 60, 0.2) !important; 
            color: #e74c3c !important; 
            border: 1px solid #e74c3c !important; 
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .table tbody tr {
            cursor: pointer;
        }
        
        .table tbody tr:hover {
            background-color: rgba(52, 152, 219, 0.2) !important;
        }

        #upload-results {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .cell-updated {
            background-color: rgba(204, 255, 0, 0.2) !important;
            font-weight: bold !important;
            color: var(--lime-green-text) !important;
            border: 1px solid rgba(204, 255, 0, 0.4) !important;
            border-radius: 4px !important;
            animation: highlightPulse 2s ease-in-out;
        }

        @keyframes highlightPulse {
            0% { box-shadow: 0 0 0 0 rgba(204, 255, 0, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(204, 255, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(204, 255, 0, 0); }
        }

    </style>
</head>
<body>
    <div class="container-fluid mt-4 pb-5">
        <div class="d-flex justify-content-between align-items-center mb-4 px-3">
            <h1><i class="bi bi-graph-up-arrow"></i> Dashboard de Imóveis</h1>
            <div class="d-flex gap-2 flex-wrap">
                <a href="/comparacao" class="btn btn-outline-info">
                    <i class="bi bi-diagram-3"></i> Comparar Imóveis
                </a>
                <a href="/imoveis_baratos" class="btn btn-outline-info">
                    <i class="bi bi-gem"></i> Imóveis Baratos
                </a>
                <button type="button" class="btn btn-info" data-bs-toggle="modal" data-bs-target="#uploadModal">
                    <i class="bi bi-upload"></i> Carregar Planilhas
                </button>
                <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#exportModal">
                    <i class="bi bi-download"></i> Exportar
                </button>
                <button id="btn-nova-raspagem" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#pesquisaModal">
                    <i class="bi bi-arrow-clockwise"></i> Nova Raspagem
                </button>
            </div>
        </div>
        
        <div class="px-3">
            <div id="summary-cards" class="row mb-4"></div>
            
            <div class="row mb-4">
                <div class="col-lg-8">
                    <div class="card h-100">
                        <div class="card-header bg-transparent border-bottom-0">
                            <h5 class="mb-0 lime-green-header">
                                <i class="bi bi-map"></i> Resumo por Estados
                            </h5>
                        </div>
                        <div class="card-body">
                            <div id="uf-summary-container" class="row"></div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="card h-100">
                        <div class="card-header bg-transparent border-bottom-0">
                            <h5 class="mb-0 lime-green-header">
                                <i class="bi bi-gem"></i> Oportunidades < R$100 mil
                            </h5>
                        </div>
                        <div class="card-body">
                            <div id="vertical-carousel-container">
                                <div id="vertical-carousel-inner"></div>
                            </div>
                            <div class="text-center mt-3">
                                <a href="/imoveis_baratos" class="btn btn-outline-info btn-sm">Ver Todas</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card mb-4">
                <div class="card-header bg-transparent">
                    <h5 class="mb-0 lime-green-header">
                        <i class="bi bi-search"></i> Consulta Avançada de Imóveis
                    </h5>
                </div>
                <div class="card-body">
                    <div class="filter-section">
                        <div class="row g-3 mb-3">
                            <div class="col-lg-2 col-md-3 col-sm-6">
                                <div class="filter-label">Estado</div>
                                <select id="uf-filter" class="form-select">
                                    <option value="">Todos os Estados</option>
                                </select>
                            </div>
                            <div class="col-lg-2 col-md-3 col-sm-6">
                                <div class="filter-label">Cidade</div>
                                <select id="cidade-filter" class="form-select">
                                    <option value="">Todas as Cidades</option>
                                </select>
                            </div>
                            <div class="col-lg-2 col-md-3 col-sm-6">
                                <div class="filter-label">Bairro</div>
                                <select id="bairro-filter" class="form-select">
                                    <option value="">Todos os Bairros</option>
                                </select>
                            </div>
                            <div class="col-lg-2 col-md-3 col-sm-6">
                                <div class="filter-label">Tipologia</div>
                                <select id="tipo-filter" class="form-select">
                                    <option value="">Todas as Tipologias</option>
                                </select>
                            </div>
                            <div class="col-lg-2 col-md-3 col-sm-6">
                                <div class="filter-label">Modalidade</div>
                                <select id="modalidade-filter" class="form-select">
                                    <option value="">Todas as Modalidades</option>
                                </select>
                            </div>
                            <div class="col-lg-2 col-md-3 col-sm-6">
                                <div class="filter-label">Status</div>
                                <select id="status-filter" class="form-select">
                                    <option value="">Todos</option>
                                    <option value="Ativos" selected>Ativos (Novo + Existente + Atualizado)</option>
                                    <option value="Apenas Novos">Apenas Novos</option>
                                    <option value="Apenas Atualizados">Apenas Atualizados</option>
                                    <option value="Expirado">Expirados</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row g-3 mb-3">
                            <div class="col-lg-2 col-md-3 col-sm-6">
                                <div class="filter-label">FGTS</div>
                                <select id="fgts-filter" class="form-select">
                                    <option value="">Todos</option>
                                    <option value="SIM">Sim</option>
                                    <option value="NÃO">Não</option>
                                </select>
                            </div>
                            <div class="col-lg-2 col-md-3 col-sm-6">
                                <div class="filter-label">Financiamento</div>
                                <select id="financiamento-filter" class="form-select">
                                    <option value="">Todos</option>
                                    <option value="SIM">Sim</option>
                                    <option value="NÃO">Não</option>
                                </select>
                            </div>
                            <div class="col-lg-2 col-md-3 col-sm-6">
                                <div class="filter-label">Data Início</div>
                                <input type="date" id="data-inicio-filter" class="form-control">
                            </div>
                            <div class="col-lg-2 col-md-3 col-sm-6">
                                <div class="filter-label">Data Fim</div>
                                <input type="date" id="data-fim-filter" class="form-control">
                            </div>
                            <div class="col-lg-2 col-md-3 col-sm-6">
                                <div class="filter-label">Preço Mínimo</div>
                                <input type="number" id="preco-min-filter" class="form-control" placeholder="R$ 0" step="1000">
                            </div>
                            <div class="col-lg-2 col-md-3 col-sm-6">
                                <div class="filter-label">Preço Máximo</div>
                                <input type="number" id="preco-max-filter" class="form-control" placeholder="R$ 1.000.000" step="1000">
                            </div>
                        </div>
                        
                        <div class="row g-3 mb-3">
                            <div class="col-lg-6">
                                <div class="filter-label">Slider de Preço (Alternativo)</div>
                                <div class="price-range-container">
                                    <div id="price-range-slider"></div>
                                    <div class="d-flex justify-content-between mt-2">
                                        <span id="price-min-value">R$ 0</span>
                                        <span id="price-max-value">R$ 1.000.000</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-end">
                            <button id="clear-filters" class="btn btn-outline-secondary me-2">
                                <i class="bi bi-arrow-counterclockwise"></i> Limpar Filtros
                            </button>
                            <button id="apply-filters" class="btn btn-primary">
                                <i class="bi bi-funnel"></i> Aplicar Filtros
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table id="imoveis-table" class="table table-dark table-striped" style="width:100%">
                            <thead>
                                <tr>
                                    <th><i class="bi bi-map"></i> UF</th>
                                    <th><i class="bi bi-geo-alt"></i> Cidade</th>
                                    <th><i class="bi bi-buildings"></i> Bairro</th>
                                    <th><i class="bi bi-signpost"></i> Endereço</th>
                                    <th><i class="bi bi-bookmark"></i> Status</th>
                                    <th><i class="bi bi-currency-dollar"></i> Preço</th>
                                    <th><i class="bi bi-calculator"></i> Avaliação</th>
                                    <th><i class="bi bi-percent"></i> Desconto</th>
                                    <th><i class="bi bi-rulers"></i> Área Privativa</th>
                                    <th><i class="bi bi-map-fill"></i> Área Terreno</th>
                                    <th><i class="bi bi-calculator-fill"></i> R$/m²</th>
                                    <th><i class="bi bi-building"></i> Tipologia</th>
                                    <th><i class="bi bi-tag"></i> Modalidade</th>
                                    <th><i class="bi bi-calendar"></i> Data Disputa</th>
                                    <th><i class="bi bi-credit-card"></i> FGTS</th>
                                    <th><i class="bi bi-bank"></i> Financiamento</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Nova Raspagem -->
    <div class="modal fade" id="pesquisaModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-cloud-download"></i> Iniciar Nova Raspagem
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted mb-3">Selecione os estados para realizar a raspagem de dados:</p>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="select-all-scraping-estados">
                        <label class="form-check-label fw-bold" for="select-all-scraping-estados">
                            Selecionar Todos os Estados
                        </label>
                    </div>
                    <hr style="border-top: 1px solid rgba(255, 255, 255, 0.1);">
                    <div id="estados-pesquisa-container"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" id="start-scraping" class="btn btn-primary">
                        <i class="bi bi-play-circle"></i> Iniciar Raspagem
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Exportação -->
    <div class="modal fade" id="exportModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-download"></i> Exportar Planilha Excel
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted mb-3">Selecione os estados que deseja exportar (ou deixe em branco para exportar todos):</p>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="select-all-export-estados">
                        <label class="form-check-label fw-bold" for="select-all-export-estados">
                            Selecionar Todos os Estados
                        </label>
                    </div>
                    <hr style="border-top: 1px solid rgba(255, 255, 255, 0.1);">
                    <div id="export-estados-container"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" id="start-export" class="btn btn-success">
                        <i class="bi bi-download"></i> Baixar Planilha
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Upload -->
    <div class="modal fade" id="uploadModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-upload"></i> Carregar Planilhas Excel
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted mb-3">
                        Selecione um ou mais arquivos Excel (.xlsx, .xls) para carregar no banco de dados.
                        Os dados existentes serão atualizados com base na matrícula do imóvel.
                    </p>
                    <input class="form-control" type="file" id="excel-files-input" multiple accept=".xlsx, .xls">
                    <div id="upload-status" class="mt-3"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" id="start-upload" class="btn btn-info">
                        <i class="bi bi-database-add"></i> Enviar e Processar
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Barra de Progresso -->
    <div id="progress-container" class="d-flex align-items-center justify-content-between">
        <div class="flex-grow-1">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <span id="progress-text" class="fw-bold"></span>
                <span id="progress-percentage" class="text-muted"></span>
            </div>
            <div class="progress">
                <div id="progress-bar" class="progress-bar" role="progressbar" style="width: 0%;"></div>
            </div>
        </div>
        <button id="cancel-scraping" class="btn btn-danger btn-sm ms-3">
            <i class="bi bi-x-circle"></i> Cancelar
        </button>
    </div>
    
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/noUiSlider@15.7.1/dist/nouislider.min.js"></script>
    <script>
    $(document).ready(function() {
        let priceSlider;
        let currentFilters = { status: 'Ativos' };
        
        const formatCurrency = (value) => {
            if (!value || value === 0 || value === '0.00') return 'R$ 0,00';
            const num = parseFloat(value);
            if (isNaN(num)) return 'N/A';
            return `R$ ${num.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
        };
        
        const formatArea = (value) => {
            if (!value || value === 'N/A' || value === 'null') return 'N/A';
            if (typeof value === 'string' && value.includes('m²')) return value;
            const num = parseFloat(value);
            if (isNaN(num)) return 'N/A';
            return `${num.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} m²`;
        };

        const calculatePricePerM2 = (preco, areaPrivativa, areaTerreno) => {
            const price = parseFloat(preco);
            if (isNaN(price) || price <= 0) return 'N/A';

            let area = 0;
            if (areaPrivativa && areaPrivativa !== 'N/A' && areaPrivativa !== 'null') {
                const areaPrivNum = parseFloat(areaPrivativa.toString().replace(/[^\d.,]/g, '').replace(',', '.'));
                if (!isNaN(areaPrivNum) && areaPrivNum > 0) {
                    area = areaPrivNum;
                }
            }

            if (area === 0 && areaTerreno && areaTerreno !== 'N/A' && areaTerreno !== 'null') {
                const areaTerNum = parseFloat(areaTerreno.toString().replace(/[^\d.,]/g, '').replace(',', '.'));
                if (!isNaN(areaTerNum) && areaTerNum > 0) {
                    area = areaTerNum;
                }
            }

            if (area <= 0) return 'N/A';

            const pricePerM2 = price / area;
            return `R$ ${pricePerM2.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
        };

        const formatStatus = (status) => {
            if (!status) status = 'Existente';
            const statusClass = status.toLowerCase();
            return `<span class="badge status-${statusClass}">${status}</span>`;
        };
        
        const table = $('#imoveis-table').DataTable({
            processing: true,
            serverSide: false,
            ajax: { 
                url: '/api/data',
                dataSrc: '',
                data: function(d) {
                    return currentFilters;
                }
            },
            columns: [
                { data: 'UF', defaultContent: 'N/A' },
                { data: 'CIDADE', defaultContent: 'N/A' },
                { data: 'BAIRRO', defaultContent: 'N/A' },
                { data: 'ENDERECO', defaultContent: 'N/A' },
                { 
                    data: 'Status', 
                    defaultContent: 'Existente',
                    render: function(data, type, row) {
                        return formatStatus(data);
                    }
                },
                { 
                    data: 'PRECO', 
                    defaultContent: '0',
                    render: function(data, type, row) {
                        return `<span class="price-column">${formatCurrency(data)}</span>`;
                    }
                },
                { 
                    data: 'AVALIACAO', 
                    defaultContent: '0',
                    render: function(data, type, row) {
                        return `<span class="price-column">${formatCurrency(data)}</span>`;
                    }
                },
                { 
                    data: 'DESCONTO', 
                    defaultContent: '0%',
                    render: function(data, type, row) {
                        return `<span class="discount-column">${data || '0%'}</span>`;
                    }
                },
                { 
                    data: 'AREA_PRIVATIVA', 
                    defaultContent: 'N/A',
                    render: function(data, type, row) {
                        return `<span class="area-column">${formatArea(data)}</span>`;
                    }
                },
                { 
                    data: 'AREA_DO_TERRENO', 
                    defaultContent: 'N/A',
                    render: function(data, type, row) {
                        return `<span class="area-column">${formatArea(data)}</span>`;
                    }
                },
                { 
                    data: null,
                    defaultContent: 'N/A',
                    render: function(data, type, row) {
                        const precoM2 = calculatePricePerM2(row.PRECO, row.AREA_PRIVATIVA, row.AREA_DO_TERRENO);
                        return `<span class="preco-m2-column">${precoM2}</span>`;
                    }
                },
                { 
                    data: 'TIPO', 
                    defaultContent: 'N/A',
                    render: function(data, type, row) {
                        return `<span class="tipo-column">${data || 'N/A'}</span>`;
                    }
                },
                { data: 'MODALIDADE', defaultContent: 'N/A' },
                { data: 'DATA_DISPUTA', defaultContent: 'N/A' },
                { 
                    data: 'FGTS', 
                    defaultContent: 'NÃO',
                    render: function(data, type, row) {
                        const isFgts = data === 'SIM';
                        const badgeClass = isFgts ? 'bg-success' : 'bg-secondary';
                        const text = isFgts ? 'Sim' : 'Não';
                        return `<span class="badge ${badgeClass}">${text}</span>`;
                    }
                },
                { 
                    data: 'FINANCIAMENTO', 
                    defaultContent: 'NÃO',
                    render: function(data, type, row) {
                        const isFinanciamento = data === 'SIM';
                        const badgeClass = isFinanciamento ? 'bg-success' : 'bg-secondary';
                        const text = isFinanciamento ? 'Sim' : 'Não';
                        return `<span class="badge ${badgeClass}">${text}</span>`;
                    }
                }
            ],
            createdRow: function(row, data, dataIndex) {
                $(row).on('click', function() {
                    if (data.LINK) {
                        window.open(data.LINK, '_blank');
                    }
                });
                
                if (data.Status === 'Atualizado' && data.ChangedFields) {
                    const changedFields = data.ChangedFields.split(',');
                    const columnsMap = {
                        'UF': 0, 'CIDADE': 1, 'BAIRRO': 2, 'ENDERECO': 3, 'Status': 4,
                        'PRECO': 5, 'AVALIACAO': 6, 'DESCONTO': 7, 'AREA_PRIVATIVA': 8,
                        'AREA_DO_TERRENO': 9, 'TIPO': 11, 'MODALIDADE': 12, 'DATA_DISPUTA': 13,
                        'FGTS': 14, 'FINANCIAMENTO': 15
                    };
                    
                    changedFields.forEach(fieldName => {
                        const trimmedField = fieldName.trim();
                        if (columnsMap.hasOwnProperty(trimmedField)) {
                            const colIndex = columnsMap[trimmedField];
                            $(row).find('td').eq(colIndex).addClass('cell-updated');
                        }
                    });
                }
            },
            language: {
                url: '//cdn.datatables.net/plug-ins/1.13.7/i18n/pt-BR.json'
            },
            lengthChange: false,
            searching: false,
            pageLength: 25,
            order: [[5, 'asc']],
            scrollX: true
        });
        
        function initializePriceSlider(minPrice, maxPrice) {
            if (priceSlider) {
                priceSlider.destroy();
            }
            
            const sliderElement = document.getElementById('price-range-slider');
            priceSlider = noUiSlider.create(sliderElement, {
                start: [minPrice, maxPrice],
                connect: true,
                range: {
                    'min': minPrice,
                    'max': maxPrice
                },
                format: {
                    to: function (value) {
                        return Math.round(value);
                    },
                    from: function (value) {
                        return Number(value);
                    }
                }
            });
            
            priceSlider.on('update', function (values, handle) {
                document.getElementById('price-min-value').textContent = formatCurrency(values[0]);
                document.getElementById('price-max-value').textContent = formatCurrency(values[1]);
            });
        }
        
        function updateFilters() {
            currentFilters = {
                status: $('#status-filter').val() || '',
                uf: $('#uf-filter').val() || '',
                cidade: $('#cidade-filter').val() || '',
                bairro: $('#bairro-filter').val() || '',
                tipo: $('#tipo-filter').val() || '',
                modalidade: $('#modalidade-filter').val() || '',
                fgts: $('#fgts-filter').val() || '',
                financiamento: $('#financiamento-filter').val() || '',
                data_inicio: $('#data-inicio-filter').val() || '',
                data_fim: $('#data-fim-filter').val() || ''
            };
            
            const precoMin = $('#preco-min-filter').val();
            const precoMax = $('#preco-max-filter').val();
            
            if (precoMin && precoMin !== '') {
                currentFilters.preco_min = parseFloat(precoMin);
            } else if (priceSlider) {
                const values = priceSlider.get();
                currentFilters.preco_min = parseFloat(values[0]);
            }
            
            if (precoMax && precoMax !== '') {
                currentFilters.preco_max = parseFloat(precoMax);
            } else if (priceSlider) {
                const values = priceSlider.get();
                currentFilters.preco_max = parseFloat(values[1]);
            }
        }
        
        $('#apply-filters').on('click', function() {
            updateFilters();
            table.ajax.reload();
        });
        
        $('#clear-filters').on('click', function() {
            $('select, input[type="date"], input[type="number"]').val('');
            $('#status-filter').val('Ativos');
            $('#cidade-filter').html('<option value="">Todas as Cidades</option>');
            $('#bairro-filter').html('<option value="">Todos os Bairros</option>');
            
            if (priceSlider) {
                const range = priceSlider.options.range;
                priceSlider.set([range.min, range.max]);
            }
            
            updateFilters();
            table.ajax.reload();
        });
        
        $('#uf-filter').on('change', function() {
            const selectedUf = $(this).val();
            $('#cidade-filter').html('<option value="">Todas as Cidades</option>').val('');
            $('#bairro-filter').html('<option value="">Todos os Bairros</option>').val('');
            
            if (selectedUf) {
                $.get('/api/cidades_por_uf', { uf: selectedUf }, function(cidades) {
                    cidades.forEach(cidade => {
                        $('#cidade-filter').append(`<option value="${cidade}">${cidade}</option>`);
                    });
                });
            }
        });
        
        $('#cidade-filter').on('change', function() {
            const selectedCidade = $(this).val();
            const selectedUf = $('#uf-filter').val();
            $('#bairro-filter').html('<option value="">Todos os Bairros</option>').val('');
            
            if (selectedCidade) {
                $.get('/api/bairros_por_cidade', { cidade: selectedCidade, uf: selectedUf }, function(bairros) {
                    bairros.forEach(bairro => {
                        $('#bairro-filter').append(`<option value="${bairro}">${bairro}</option>`);
                    });
                });
            }
        });
        
        let scrapingEventSource = null;
        
        function updateProgressBar(message, current, total, statusClass) {
            const percentage = total > 0 ? Math.round((current / total) * 100) : 0;
            const progressText = total > 0 ? `${message}` : message;
            
            $('#progress-bar')
                .css('width', percentage + '%')
                .removeClass('bg-success bg-danger bg-warning')
                .addClass(statusClass === 'error' ? 'bg-danger' : 'bg-success');
            $('#progress-text').text(progressText);
            $('#progress-percentage').text(`${percentage}%`);
        }
        
        function stopScraping(isSuccess) {
            if (scrapingEventSource) {
                scrapingEventSource.close();
                scrapingEventSource = null;
            }
            $('#btn-nova-raspagem').prop('disabled', false).html('<i class="bi bi-arrow-clockwise"></i> Nova Raspagem');
            
            if (isSuccess) {
                updateProgressBar('Processo finalizado! Atualizando dados...', 100, 100, 'success');
                setTimeout(() => {
                    $('#progress-container').fadeOut(500);
                    setTimeout(() => {
                        location.reload();
                    }, 500);
                }, 3000);
            } else {
                setTimeout(() => {
                    $('#progress-container').fadeOut(500);
                }, 5000);
            }
        }
        
        $('#cancel-scraping').on('click', function() {
            updateProgressBar('Processo cancelado pelo usuário.', 100, 100, 'error');
            stopScraping(false);
        });
        
        $('#start-scraping').on('click', function() {
            const selectedEstados = Array.from(document.querySelectorAll('#estados-pesquisa-container input:checked'))
                .map(cb => cb.value);
            
            if (selectedEstados.length === 0) {
                alert('Por favor, selecione pelo menos um estado.');
                return;
            }
            
            const modal = bootstrap.Modal.getInstance(document.getElementById('pesquisaModal'));
            modal.hide();
            
            $('#btn-nova-raspagem').prop('disabled', true).html('<i class="bi bi-hourglass-split"></i> Processando...');
            $('#progress-container').fadeIn(300);
            
            scrapingEventSource = new EventSource('/processar?estados=' + selectedEstados.join(','));
            
            scrapingEventSource.onmessage = function(event) {
                const data = JSON.parse(event.data);
                
                switch(data.type) {
                    case 'stage':
                    case 'download':
                        updateProgressBar(data.message, 0, 100, 'processing');
                        break;
                    case 'property_progress':
                        updateProgressBar(`${data.message || 'Processando imóveis'} - ${data.current}/${data.total}`, data.current, data.total, 'processing');
                        break;
                    case 'expired_properties':
                        updateProgressBar(`Identificando imóveis expirados - ${data.current || 0}/${data.total || 0}`, data.current || 0, data.total || 0, 'processing');
                        break;
                    case 'updating_status':
                        updateProgressBar('Atualizando status dos imóveis...', 90, 100, 'processing');
                        break;
                    case 'done':
                        updateProgressBar('Processo finalizado! Recarregando dados...', 100, 100, 'success');
                        stopScraping(true);
                        break;
                    case 'error':
                        updateProgressBar(`Erro: ${data.message}`, 100, 100, 'error');
                        stopScraping(false);
                        break;
                    default:
                        updateProgressBar(data.message || 'Processando...', 0, 100, 'processing');
                        break;
                }
            };
            
            scrapingEventSource.onerror = function(err) {
                updateProgressBar('Conexão com o servidor perdida.', 100, 100, 'error');
                stopScraping(false);
            };
        });
        
        function loadSummaryData() {
            $.get('/api/summary', function(data) {
                $('#summary-cards').html(`
                    <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                        <div class="card kpi-card h-100">
                            <div class="card-body text-center">
                                <h5><i class="bi bi-house"></i> Total de Imóveis</h5>
                                <p>${data.stats.total_imoveis.toLocaleString('pt-BR')}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                        <div class="card kpi-card h-100">
                            <div class="card-body text-center">
                                <h5><i class="bi bi-plus-circle"></i> Novos Imóveis</h5>
                                <p>${data.stats.novos_imoveis.toLocaleString('pt-BR')}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                        <div class="card kpi-card h-100">
                            <div class="card-body text-center">
                                <h5><i class="bi bi-arrow-up-circle"></i> Atualizados</h5>
                                <p>${data.stats.atualizados.toLocaleString('pt-BR')}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                        <div class="card kpi-card h-100">
                            <div class="card-body text-center">
                                <h5><i class="bi bi-x-circle"></i> Expirados</h5>
                                <p style="color: #e74c3c;">${data.stats.expirados.toLocaleString('pt-BR')}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                        <div class="card kpi-card h-100">
                            <div class="card-body text-center">
                                <h5><i class="bi bi-check-circle"></i> Ativos</h5>
                                <p style="color: #2ecc71;">${data.stats.ativos.toLocaleString('pt-BR')}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                        <div class="card kpi-card h-100">
                            <div class="card-body text-center">
                                <h5><i class="bi bi-currency-dollar"></i> Preço Médio</h5>
                                <p style="font-size: 1.8rem;">${formatCurrency(data.stats.media_preco)}</p>
                            </div>
                        </div>
                    </div>
                `);
                
                loadStatesSummary(data.uf_summary);
            });
        }
        
        function loadStatesSummary(ufSummary) {
            const container = $('#uf-summary-container').empty();
            
            if (!ufSummary || ufSummary.length === 0) {
                container.html('<p class="text-center text-muted">Nenhum dado disponível</p>');
                return;
            }
            
            const chunks = [
                ufSummary.slice(0, 9),
                ufSummary.slice(9, 18),
                ufSummary.slice(18, 27)
            ];
            
            chunks.forEach(chunk => {
                if (chunk.length > 0) {
                    let tableHtml = `
                        <div class="col-md-4">
                            <table class="table table-dark table-sm">
                                <thead>
                                    <tr>
                                        <th>UF</th>
                                        <th>Total</th>
                                        <th>Novos</th>
                                        <th>Atualizados</th>
                                        <th>Expirados</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    chunk.forEach(uf => {
                        tableHtml += `
                            <tr>
                                <td><strong>${uf.UF}</strong></td>
                                <td>${uf.Total.toLocaleString('pt-BR')}</td>
                                <td class="text-success">${(uf.Novos || 0).toLocaleString('pt-BR')}</td>
                                <td class="text-warning">${(uf.Atualizados || 0).toLocaleString('pt-BR')}</td>
                                <td class="text-danger">${(uf.Expirados || 0).toLocaleString('pt-BR')}</td>
                            </tr>
                        `;
                    });
                    
                    tableHtml += '</tbody></table></div>';
                    container.append(tableHtml);
                }
            });
        }
        
        function populateFilters() {
            $.get('/api/filters', function(data) {
                const filterMappings = {
                    'uf': { data: data.ufs, placeholder: 'Todos os Estados' },
                    'cidade': { data: data.cidades, placeholder: 'Todas as Cidades' },
                    'bairro': { data: data.bairros, placeholder: 'Todos os Bairros' },
                    'tipo': { data: data.tipos, placeholder: 'Todas as Tipologias' },
                    'modalidade': { data: data.modalidades, placeholder: 'Todas as Modalidades' }
                };
                
                Object.keys(filterMappings).forEach(filterName => {
                    const select = $(`#${filterName}-filter`);
                    const mapping = filterMappings[filterName];
                    select.html(`<option value="">${mapping.placeholder}</option>`);
                    
                    (mapping.data || []).forEach(option => {
                        select.append(`<option value="${option}">${option}</option>`);
                    });
                });
                
                if (data.preco_range && data.preco_range.max > data.preco_range.min) {
                    initializePriceSlider(data.preco_range.min, data.preco_range.max);
                } else {
                    initializePriceSlider(0, 1000000);
                }
            });
        }
        

        function loadStatesForActions() {
            const allStates = ['AC', 'AL', 'AP', 'AM', 'BA', 'CE', 'DF', 'ES', 'GO', 'MA', 'MT', 'MS', 'MG', 'PA', 'PB', 'PR', 'PE', 'PI', 'RJ', 'RN', 'RS', 'RO', 'RR', 'SC', 'SP', 'SE', 'TO'];

            $.get('/api/distinct_ufs', function(ufsFromDB) {
                const scrapingContainer = $('#estados-pesquisa-container');
                const exportContainer = $('#export-estados-container');
                
                scrapingContainer.empty();
                allStates.forEach(uf => {
                    scrapingContainer.append(`
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="${uf}" id="scraping-${uf}">
                            <label class="form-check-label" for="scraping-${uf}">${uf}</label>
                        </div>
                    `);
                });
                exportContainer.empty();
                if (ufsFromDB && ufsFromDB.length > 0) {
                    ufsFromDB.forEach(uf => {
                        exportContainer.append(`
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="${uf}" id="export-${uf}">
                                <label class="form-check-label" for="export-${uf}">${uf}</label>
                            </div>
                        `);
                    });
                } else {
                    exportContainer.html('<p class="text-muted">Nenhum estado com dados para exportar.</p>');
                }
            });
        }
        
        function loadCheapProperties() {
            $.get('/api/imoveis_baratos', function(data) {
                const container = $('#vertical-carousel-inner').empty();
                
                if (data.length === 0) {
                    container.html('<div class="text-center p-4"><p class="text-muted">Nenhuma oportunidade encontrada</p></div>');
                    return;
                }
                
                let itemHtml = '';
                data.slice(0, 15).forEach(imovel => {
                    itemHtml += `
                        <div class="mb-3">
                            <a href="${imovel.LINK}" target="_blank" class="text-decoration-none">
                                <div class="opportunity-card">
                                    <h5>${formatCurrency(imovel.PRECO)}</h5>
                                    <p><i class="bi bi-geo-alt"></i> ${imovel.CIDADE} - ${imovel.UF}</p>
                                    <p><i class="bi bi-house"></i> ${imovel.TIPO || 'Imóvel'}</p>
                                    <p><i class="bi bi-map"></i> ${imovel.BAIRRO || 'Bairro não informado'}</p>
                                </div>
                            </a>
                        </div>
                    `;
                });
                
                container.html(itemHtml.repeat(3));
            });
        }
        
        $('#select-all-scraping-estados').on('change', function() {
            $('#estados-pesquisa-container input[type="checkbox"]').prop('checked', this.checked);
        });
        
        $('#select-all-export-estados').on('change', function() {
            $('#export-estados-container input[type="checkbox"]').prop('checked', this.checked);
        });
        
        $('#start-export').on('click', function() {
            const selectedEstados = Array.from(document.querySelectorAll('#export-estados-container input:checked'))
                .map(cb => cb.value);
            
            let downloadUrl = '/export/xlsx-hyperlink';
            if (selectedEstados.length > 0) {
                downloadUrl += '?estados=' + selectedEstados.join(',');
            }
            
            window.location.href = downloadUrl;
            
            const modal = bootstrap.Modal.getInstance(document.getElementById('exportModal'));
            modal.hide();
        });

        $('#start-upload').on('click', function() {
            const filesInput = document.getElementById('excel-files-input');
            const files = filesInput.files;
            const statusDiv = $('#upload-status');
            const uploadButton = $(this);

            if (files.length === 0) {
                statusDiv.html('<div class="alert alert-warning">Por favor, selecione pelo menos um arquivo.</div>');
                return;
            }

            const formData = new FormData();
            for (let i = 0; i < files.length; i++) {
                formData.append('files', files[i]);
            }

            statusDiv.html('<div class="d-flex align-items-center"><strong>Enviando e processando...</strong><div class="spinner-border ms-auto" role="status" aria-hidden="true"></div></div>');
            uploadButton.prop('disabled', true);

            $.ajax({
                url: '/upload_excel',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    let resultsHtml = `<div class="alert alert-success">${response.message}</div><ul>`;
                    response.results.forEach(res => {
                        resultsHtml += `<li class="${res.success ? 'text-success' : 'text-danger'}"><strong>${res.file}:</strong> ${res.message}</li>`;
                    });
                    resultsHtml += '</ul>';
                    statusDiv.html(resultsHtml);
                    
                    setTimeout(() => {
                        location.reload();
                    }, 4000);
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    let errorMsg = 'Ocorreu um erro inesperado.';
                    if (jqXHR.responseJSON && jqXHR.responseJSON.message) {
                        errorMsg = jqXHR.responseJSON.message;
                    }
                    statusDiv.html(`<div class="alert alert-danger">${errorMsg}</div>`);
                    uploadButton.prop('disabled', false);
                }
            });
        });
        
        updateFilters();
        loadSummaryData();
        populateFilters();
        loadStatesForActions();
        loadCheapProperties();
    });
    </script>
</body>
</html>